# 멀티 서버에서의 동시성 문제

리버시 게임 프로젝트를 진행하면서, 확장성 있는 WebSocket 기반의 실시간 게임 서버 구조를 만들기 위해 Redis Pub/Sub 기반의 멀티 서버 아키텍처를 고려했습니다.</br></br>

초기 설계에서는 Redis에 게임 방 상태를 저장하고, 각 WebSocket서버가 이를 공유하는 방식으로 확장성을 확보하려 했습니다. </br></br>

그러나 서로 다른 서버가 동일한 redis 리소스에 접근하는 경우 동시성 문제가 발생한다는 것을 뒤늦게 알게 되었습니다.</br></br>

이를 해결하기위해 redis의 CAS방식이나 루아스크립트를 사용하여 원자성을 보장해주는 방식을 고려해보았지만 정합성을 보장하기 위한 구현난이도가 상승하고, latency가 증가하여 실시간 게임 특성상 부정적인 영향을 준다고 판단했습니다.</br></br>

따라서, 방 생성시에 해당 서버가 그 방에대한 writer 권한을 가지는 방식으로 구조를 변경했습니다. </br></br>
즉, 논리적으로 같은 방에 속하지만, writer서버에 존재하지 않는 유저가 상태 변경요청을 보낼경우 직접 redis에 update하는 것이 아닌 writer 서버에 message를 보내 간접적으로 update하는 방식입니다.</br></br>

현재는 서버간 통신을 어떤 방식으로 구현하는 것이 적합한지 고민하고 있습니다.</br></br>

<img width="720" height="788" alt="스크린샷 2025-11-15 오후 4 12 09" src="https://github.com/user-attachments/assets/25d2ed6a-81bf-499e-8057-100624148db8" />
